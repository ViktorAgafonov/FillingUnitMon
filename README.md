# FillingUnitMon

**Система мониторинга и отчётности для тестомесов с поддержкой Modbus (COM/TCP), гибкой настройкой и удобным интерфейсом.**

---

## Назначение

Программа предназначена для мониторинга работы тестомесов, сбора данных о взвешивании, формирования отчётов и анализа отклонений. Поддерживается гибкая настройка Modbus-подключения и индивидуальные параметры для каждого тестомеса.

---

## Архитектура
- **Node.js + Express**: серверная часть, REST API, маршруты
- **EJS**: шаблонизация интерфейса
- **Frontend**: современный JS (report.js, settings.js, main.js)
- **Modbus**: modbus-serial, поддержка COM и TCP
- **Конфиги**: JSON-файлы (kneaders, recipes, settings)

---

## Основные функции
- Мониторинг состояния тестомесов в реальном времени
- Гибкая настройка подключения к Modbus (COM/TCP)
- Индивидуальные параметры чтения данных для каждого тестомеса
- Группировка и цветовая индикация отклонений в отчётах
- Архивация событий и экспорт отчётов в XLS
- Логирование событий добавления/удаления тестомесов

---

## Конфигурация Modbus (config/settings.json)
```json
{
  "modbus": {
    "type": "com", // "com" — последовательный порт, "tcp" — сетевое подключение
    "com": {
      "port": "COM1",
      "baudRate": 9600,
      "dataBits": 8,
      "parity": "none",
      "stopBits": 1
    },
    "tcp": {
      "host": "192.168.0.100",
      "port": 502
    }
  }
}
```
- **type**: тип подключения (com/tcp)
- **com**: параметры COM-порта
- **tcp**: параметры TCP-подключения

---

## Конфигурация тестомесов (config/kneaders.json)
```json
{
  "kneaders": [
    {
      "name": "Тестомес 1",
      "modbusAddress": 1,
      "register": 100,
      "registerCount": 2,
      "dataType": "float32",
      "byteOrder": "swapped"
    }
  ]
}
```
- **register**: адрес первого регистра веса
- **registerCount**: сколько регистров читать (2 для float32)
- **dataType**: float32, int32, uint16
- **byteOrder**: порядок байтов (normal, swapped, reverse)

### Подсказки по byteOrder
- **normal**: стандартный порядок
- **swapped**: регистры меняются местами (для некоторых весов)
- **reverse**: все байты в обратном порядке

---

## Конфигурация рецептов (config/recipes.json)
```json
[
  { "name": "Буханка", "minWeight": 20, "maxWeight": 25 }
]
```

---

## Запуск и требования
- Node.js >= 16
- npm install
- npm start
- Открыть http://localhost:3000

---

## Типовые ошибки
- **SyntaxError в JSON** — проверьте, что нет комментариев и все поля в двойных кавычках
- **Ошибка подключения Modbus** — проверьте параметры подключения и кабели
- **Нет данных** — проверьте настройки register, registerCount, dataType, byteOrder для тестомеса

---

## Контакты для поддержки
- Автор/разработчик: [ваше имя или email]

---

## Быстрые подсказки
- Для большинства весов подходит dataType: float32, registerCount: 2
- Если показания некорректны — попробуйте сменить byteOrder
- Все изменения в настройках применяются сразу после сохранения

---
